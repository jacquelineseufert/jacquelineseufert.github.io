<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/sidebar.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  /* === Footer year === */
  const yearEl = document.getElementById("year");
  if (yearEl) yearEl.textContent = new Date().getFullYear();

  const cvPage = document.querySelector("#main.alt");
  if (!cvPage) return;

  const buttons = document.querySelectorAll(".aud-btn");

  /* === Audience filter === */
  function filterCV(tag) {
    cvPage.querySelectorAll("li[data-tags]").forEach(item => {
      const tags = item.getAttribute("data-tags")?.split(",") || [];
      item.classList.toggle("hidden-role", !tags.includes(tag));
    });

    cvPage.querySelectorAll(".pill[data-tags]").forEach(pill => {
      const tags = pill.getAttribute("data-tags")?.split(",") || [];
      pill.classList.toggle("hidden-role", !tags.includes(tag));
    });
  }

  /* === Audience buttons === */
  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      if (btn.getAttribute("aria-pressed") === "true") return;
      buttons.forEach(b => b.setAttribute("aria-pressed", "false"));
      btn.setAttribute("aria-pressed", "true");
      filterCV(btn.dataset.audience);
    });
  });

  /* === Collapsibles === */
  cvPage.querySelectorAll(".collapsible").forEach(card => {
    const header = card.querySelector(".collapsible-header");
    const content = card.querySelector(".collapsible-content");
    const arrow = header.querySelector(".arrow");

    if (!header || !content || !arrow) return;

    // collapsed by default
    content.style.maxHeight = null;

    header.addEventListener("click", () => {
      card.classList.toggle("open");

      if (card.classList.contains("open")) {
        content.style.maxHeight = content.scrollHeight + "px";
        arrow.style.transform = "rotate(90deg)";
      } else {
        content.style.maxHeight = null;
        arrow.style.transform = "rotate(0deg)";
      }
    });
  });

  /* === Default audience view === */
  filterCV("data");
});

window.addEventListener("load", () => {
  document.body.classList.remove("is-preload");
});
</script>
</body>
</html>
